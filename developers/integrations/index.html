<!doctype html><html lang=en-us><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="ie=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><link rel=preload as=font href=https://yio-remote.github.io/documentation/fonts/vendor/jost/jost-v4-latin-regular.woff2 type=font/woff2 crossorigin><link rel=preload as=font href=https://yio-remote.github.io/documentation/fonts/vendor/jost/jost-v4-latin-700.woff2 type=font/woff2 crossorigin><link rel=stylesheet href=https://yio-remote.github.io/documentation/main.41f4e12d8577edbe348004973f8e5cd53ce413089a172e94c7d26aaa149801a054e147cca2aee89b3d327351ac23a4cf9bd74a3d19235ac438c7a63314cd7c9e.css integrity="sha512-QfThLYV37b40gASXP45c1TzkEwiaFy6Ux9JqqhSYAaBU4UfMoq7omz0yc1GsI6TPm9dKPRkjWsQ4x6YzFM18ng==" crossorigin=anonymous><noscript><style>img.lazyload{display:none}</style></noscript><meta name=robots content="index, follow"><meta name=googlebot content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1"><meta name=bingbot content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1"><title>Creating integrations - YIO</title><meta name=description content="Integrations are the interface between YIO-remote and the outside world."><link rel=canonical href=https://yio-remote.github.io/documentation/developers/integrations/><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="/developers/integrations/yio-logo.png"><meta name=twitter:title content="Creating integrations"><meta name=twitter:description content="Integrations are the interface between YIO-remote and the outside world."><meta name=twitter:site content="@yioremote"><meta name=twitter:creator content="@yioremote"><meta property="og:title" content="Creating integrations"><meta property="og:description" content="Integrations are the interface between YIO-remote and the outside world."><meta property="og:type" content="article"><meta property="og:url" content="/developers/integrations/"><meta property="og:image" content="/developers/integrations/yio-logo.png"><meta property="og:site_name" content="YIO"><meta property="article:publisher" content="https://www.facebook.com/YIOremote"><meta property="article:author" content="https://www.facebook.com/YIOremote"><meta property="og:locale" content="en_US"><script type=application/ld+json>{"@context":"http://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Home","item":"https:\/\/yio-remote.github.io\/documentation\/"},{"@type":"ListItem","position":3,"name":"Developers","item":"https:\/\/yio-remote.github.io\/documentation\/\/developers\/"},{"@type":"ListItem","position":4,"name":"Integrations","item":"https:\/\/yio-remote.github.io\/documentation\/\/developers\/integrations\/"}]}</script><meta name=theme-color content="#fff"><link rel=apple-touch-icon sizes=180x180 href=https://yio-remote.github.io/documentation/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=https://yio-remote.github.io/documentation/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=https://yio-remote.github.io/documentation/favicon-16x16.png><link rel=manifest href=https://yio-remote.github.io/documentation/site.webmanifest></head><body class="developers single"><script>(localStorage.getItem('theme')==='dark'||localStorage.getItem('theme')===null)&&document.body.classList.add('dark')</script><div class="header-bar fixed-top"></div><header class="navbar fixed-top navbar-expand-md navbar-light"><div class=container><input class="menu-btn order-0" type=checkbox id=menu-btn>
<label class="menu-icon d-md-none" for=menu-btn><span class=navicon></span></label><a class="navbar-brand order-1 order-md-0 me-auto" href=https://yio-remote.github.io/documentation/>YIO</a>
<button id=mode class="btn btn-link order-2 order-md-4" type=button aria-label="Toggle mode">
<span class=toggle-dark><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-moon"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg></span><span class=toggle-light><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-sun"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></span></button><ul class="navbar-nav social-nav order-3 order-md-5"><li class=nav-item><a class=nav-link href=https://github.com/YIO-remote><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-github"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77 5.44 5.44.0 003.5 8.55c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg><span class="ms-2 visually-hidden">GitHub</span></a></li><li class=nav-item><a class=nav-link href=http://chat.yio-remote.com/><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="currentcolor"><path d="M20.222.0c1.406.0 2.54 1.137 2.607 2.475V24l-2.677-2.273-1.47-1.338-1.604-1.398.67 2.205H3.71c-1.402.0-2.54-1.065-2.54-2.476V2.48C1.17 1.142 2.31.003 3.715.003h16.5L20.222.0zm-6.118 5.683h-.03l-.202.2c2.073.6 3.076 1.537 3.076 1.537-1.336-.668-2.54-1.002-3.744-1.137-.87-.135-1.74-.064-2.475.0h-.2c-.47.0-1.47.2-2.81.735-.467.203-.735.336-.735.336s1.002-1.002 3.21-1.537l-.135-.135s-1.672-.064-3.477 1.27c0 0-1.805 3.144-1.805 7.02.0.0 1 1.74 3.743 1.806.0.0.4-.533.805-1.002-1.54-.468-2.14-1.404-2.14-1.404s.134.066.335.2h.06c.03.0.044.015.06.03v.006c.016.016.03.03.06.03.33.136.66.27.93.4.466.202 1.065.403 1.8.536.93.135 1.996.2 3.21.0.6-.135 1.2-.267 1.8-.535.39-.2.87-.4 1.397-.737.0.0-.6.936-2.205 1.404.33.466.795 1 .795 1 2.744-.06 3.81-1.8 3.87-1.726.0-3.87-1.815-7.02-1.815-7.02-1.635-1.214-3.165-1.26-3.435-1.26l.056-.02zm.168 4.413c.703.0 1.27.6 1.27 1.335.0.74-.57 1.34-1.27 1.34s-1.27-.6-1.27-1.334c.002-.74.573-1.338 1.27-1.338zm-4.543.0c.7.0 1.266.6 1.266 1.335.0.74-.57 1.34-1.27 1.34s-1.27-.6-1.27-1.334c0-.74.57-1.338 1.27-1.338z"/></svg><span class="ms-2 visually-hidden">Discord</span></a></li><li class=nav-item><a class=nav-link href=https://community.yio-remote.com/><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-message-square"><path d="M21 15a2 2 0 01-2 2H7l-4 4V5a2 2 0 012-2h14a2 2 0 012 2z"/></svg><span class="ms-2 visually-hidden">Forum</span></a></li></ul><div class="collapse navbar-collapse order-4 order-md-1"><ul class="navbar-nav main-nav me-auto order-5 order-md-2"><li class=nav-item><a class=nav-link href=https://yio-remote.github.io/documentation/>Docs</a></li><li class=nav-item><a class=nav-link href=https://yio-remote.github.io/documentation/developers/api>Developers</a></li><li class=nav-item><a class=nav-link href=https://yio-remote.github.io/documentation/community>Community</a></li><li class=nav-item><a class=nav-link href=https://yio-remote.github.io/documentation/contribute>Contribute</a></li></ul><div class="break order-6 d-md-none"></div><form class="navbar-form flex-grow-1 order-7 order-md-3"><input id=userinput class="form-control is-search" type=search placeholder="Search docs..." aria-label="Search docs..." autocomplete=off><div id=suggestions class="shadow bg-white rounded"></div></form></div></div></header><div class="wrap container" role=document><div class=content><div class="row flex-xl-nowrap"><div class="col-lg-5 col-xl-4 docs-sidebar"><nav class=docs-links aria-label="Main navigation"><h3>Home</h3><ul class=list-unstyled><li><a class=docs-link href=https://yio-remote.github.io/documentation/developers/ssh/>SSH / SCP</a></li><li><a class=docs-link href=https://yio-remote.github.io/documentation/developers/architecture/>Architecture</a></li><li><a class=docs-link href=https://yio-remote.github.io/documentation/developers/contribute/coding-guidelines/>Coding guidelines</a></li><li><a class=docs-link href=https://yio-remote.github.io/documentation/developers/configuration-file/>Configuration file</a></li><li><a class="docs-link active" href=https://yio-remote.github.io/documentation/developers/integrations/>Creating integrations</a></li><li><a class=docs-link href=https://yio-remote.github.io/documentation/developers/entity-types/>Entity types</a></li><li><a class=docs-link href=https://yio-remote.github.io/documentation/developers/logging/>Logging</a></li></ul><h3>Build Environment</h3><ul class=list-unstyled><li><a class=docs-link href=https://yio-remote.github.io/documentation/developers/build-environment/setup-ide/>Setup QT IDE</a></li><li><a class=docs-link href=https://yio-remote.github.io/documentation/developers/build-environment/setup-virtual-machine/>Setup Ubuntu Developer VM</a></li><li><a class=docs-link href=https://yio-remote.github.io/documentation/developers/build-environment/buildroot/>Buildroot</a></li></ul><h3>API</h3><ul class=list-unstyled><li><a class=docs-link href=https://yio-remote.github.io/documentation/developers/api/>API</a></li><li><a class=docs-link href=https://yio-remote.github.io/documentation/developers/websocket-api/>Websocket API</a></li></ul></nav></div><nav class="docs-toc d-none d-xl-block col-xl-3" aria-label="Secondary navigation"><div class=page-links><h3>On this page</h3><nav id=TableOfContents><ul><li><a href=#plugin-project-setup>Plugin Project Setup</a><ul><li><a href=#environment-setup>Environment Setup</a></li><li><a href=#plugin-project-file>Plugin Project File</a></li></ul></li><li><a href=#the-plugin-class---instance-factory>The plugin class - instance factory</a></li><li><a href=#the-integration-instance-class>The integration instance class</a></li><li><a href=#performance-considerations>Performance Considerations</a></li></ul></nav></div></nav><main class="docs-content col-lg-11 col-xl-9 mx-xl-auto"><h1>Creating integrations</h1><p class=lead></p><p>Integrations are the interface between YIO-remote and the outside world.
Using the &ldquo;smarthome - typical&rdquo; openHAB integration as example the necessary pieces of an integration are explained.</p><h2 id=plugin-project-setup>Plugin Project Setup<a href=#plugin-project-setup class=anchor aria-hidden=true>#</a></h2><h3 id=environment-setup>Environment Setup<a href=#environment-setup class=anchor aria-hidden=true>#</a></h3><p>To develop a YIO Remote integration plugin the <a href=https://github.com/YIO-Remote/integrations.library/tree/develop>integrations.library</a> project needs to be checked out and made accessible for the plugin project.<br>We recommend to check out <code>integrations.library</code> on the same level as the plugin project. I.e. the library can be referenced with the default path <code>../integrations.library</code>.<br>This is the only mandatory dependency of an integration plugin project.</p><p>Example for an imaginary FooBar plugin:</p><pre><code>~/projects
└── yio
    ├── integration.foobar
    ├── integrations.library
    └── remote-software
</code></pre><p>For other non-standard project setups there&rsquo;s the <code>YIO_SRC</code> environment variable. It needs to be initialized to the base directory of the integrations.library project.</p><h3 id=plugin-project-file>Plugin Project File<a href=#plugin-project-file class=anchor aria-hidden=true>#</a></h3><p>Blueprint to include one or more integration Qt project includes into the plugin project:</p><pre><code>INTG_LIB_PATH = $$(YIO_SRC)
isEmpty(INTG_LIB_PATH) {
    INTG_LIB_PATH = $$clean_path($$PWD/../integrations.library)
    message(&quot;Environment variables YIO_SRC not defined! Using '$$INTG_LIB_PATH' for integrations.library project.&quot;)
} else {
    INTG_LIB_PATH = $$(YIO_SRC)/integrations.library
    message(&quot;YIO_SRC is set: using '$$INTG_LIB_PATH' for integrations.library project.&quot;)
}

! include($$INTG_LIB_PATH/yio-plugin-lib.pri) {
    error( &quot;Cannot find the yio-plugin-lib.pri file!&quot; )
}
</code></pre><h2 id=the-plugin-class---instance-factory>The plugin class - instance factory<a href=#the-plugin-class---instance-factory class=anchor aria-hidden=true>#</a></h2><p>The plugin class is used to setup an integration. Its <strong>create</strong> function is used to create one or more integration instances. An integration should used categorized logging, which can be controlled from outside to adjust the log levels using <strong>setLogEnabled</strong> function. A reference of the <em>_log</em> object must be propagated to the integration instances.
The category name must be equal to the name of the plugin.</p><p><strong>Create</strong> function parameters :</p><ul><li><strong>config</strong> the configuration parameters of the integration</li><li><strong>entities</strong> all entities (cast to <strong>EntitiesInterface</strong>)</li><li><strong>notifications</strong> (cast to <strong>NotificationsInterface</strong>)</li><li><strong>api</strong> (cast to <strong>YioAPIInterface</strong>)</li><li><strong>configObj</strong> whole config.json (cast to <strong>ConfigInterface</strong>)</li></ul><p>Sample :</p><pre><code>class OpenHABPlugin : public PluginInterface
{
    Q_OBJECT
    Q_PLUGIN_METADATA(IID &quot;YIO.PluginInterface&quot; FILE &quot;openhab.json&quot;)
    Q_INTERFACES(PluginInterface)
public:
    explicit OpenHABPlugin (QObject* parent = nullptr) :
        _log(&quot;openhab&quot;)
    {
        Q_UNUSED(parent)
    }
    virtual ~OpenHABPlugin () override
    {}
    void        create         (const QVariantMap&amp; config, QObject *entities, QObject *notifications, QObject* api,
                                QObject *configObj) override;
    void        setLogEnabled  (QtMsgType msgType, bool enable) override
    {
        _log.setEnabled(msgType, enable);
    }
private:
    QLoggingCategory    _log;
};
</code></pre><p>The <strong>create</strong> functions creates the integration instances, calls their <strong>setup</strong> function and emits <strong>createDone</strong> with information about all instances.</p><p>Sample :</p><pre><code>void OpenHABPlugin::create(const QVariantMap &amp;config, QObject *entities, QObject *notifications, QObject *api, QObject *configObj)
{
    QMap&lt;QObject *, QVariant&gt;   returnData;
    QVariantList                data;

    for (QVariantMap::const_iterator iter = config.begin(); iter != config.end(); ++iter) {
        if (iter.key() == &quot;data&quot;) {
            data = iter.value().toList();
            break;
        }
    }
    for (int i = 0; i &lt; data.length(); i++)
    {
        OpenHAB* openhab = new OpenHAB(_log, this);
        openhab-&gt;setup(data[i].toMap(), entities, notifications, api, configObj);
        QVariantMap d = data[i].toMap();
        d.insert(&quot;type&quot;, config.value(&quot;type&quot;).toString());
        returnData.insert(openhab, d);
    }
    if (data.length() &gt; 0)
        emit createDone(returnData);
}
</code></pre><h2 id=the-integration-instance-class>The integration instance class<a href=#the-integration-instance-class class=anchor aria-hidden=true>#</a></h2><p>The integration instance class must derive from the <strong>Integration class</strong>. It provides some features common for all integrations:</p><ul><li>Properties<ul><li><strong>state</strong> (CONNECTED, CONNECTING, DISCONNECTED) must be set by the integration calling <strong>setState</strong>. This function implicetly sets the <strong>connected</strong> state of all entities of the integration.</li><li><strong>integrationId</strong> and <strong>friendlyName</strong>, both are set by the Integration::setup function which <strong>must</strong> be called by the integrations setup function.</li><li><strong>m_entities</strong> is set to the <strong>EntitiesInterface</strong>, which can be used to access all entities.</li></ul></li><li>Virtual Functions<ul><li><strong>connect</strong> (must be overriden)</li><li><strong>disconnect</strong> (must be overriden)</li><li><strong>enterStandby</strong> (overriden if required)</li><li><strong>leaveStandby</strong> (overriden if required)</li><li><strong>sendCommand</strong> gets the commands (must be overriden)</li></ul></li><li><strong>setup</strong> function, must be called by integrations setup function</li><li><strong>setState</strong> function indicates change of connection state, must be called by the integration instance. It implicitelly set the &ldquo;connected&rdquo; state of every entity belonging to the integration.</li></ul><p>Sample :</p><pre><code>void OpenHAB::setup (const QVariantMap&amp; config, QObject *entities, QObject *notifications, QObject* api, QObject *configObj)
{
    Integration::setup (config, entities);
</code></pre><p>The function <strong>connect</strong> is called at startup and when Wifi connection is reestablished. <strong>disconnect</strong> is called before WiFi is turned off. <strong>enterStandby</strong> and <strong>leaveStandby</strong> are called when the standby mode changes. Especially for polling integrations we recommend to adjust the polling interval when the YIO remote is standby to save power.</p><p>A really smart integration should check, if it gets information for every entity belonging to it. If not, this entity should be set to <strong>not connected</strong>.</p><h2 id=performance-considerations>Performance Considerations<a href=#performance-considerations class=anchor aria-hidden=true>#</a></h2><p>While the UI uses CPU only when there is some user interaction, integrations are running permanently. Paying attention to performance is not primarily necessary to gain speed but to save battery power. Here some recommendations :</p><ul><li>Don&rsquo;t work with <strong>strings</strong>, use <strong>enums</strong>. They are at minimum hundred times faster.</li><li>Don&rsquo;t rely on compiler optimization. Build <strong>intermediate results</strong> instead of computing again and again the same chains of variantMap.value(&ldquo;xxx&rdquo;).toMap().value(&ldquo;yyy&rdquo;).toMap().value(&ldquo;zzz&rdquo;)</li><li>Return <strong>references</strong> (&) whereever possible instead of copying complex objects like <em>QVariantMap</em>, <em>QStringList</em>, etc.</li><li>Use <strong>enter/leaveStandby</strong></li><li>Reuse &ldquo;expensive* objects like *QNetworkAccessManager*</li><li>Use <strong>dynamically allocated objects</strong> only if necessary, it helps also to avoid memory leaks.</li><li>Implement <strong>feature rich classes</strong> instead of implementing multiple used functionalities outside the class</li><li>Processing <strong>JSON</strong> data with <strong>QJSonObject</strong> and <strong>QJsonArray</strong> is faster then taking the detour with <strong>QVariantMap</strong> and <strong>QVariantList</strong></li></ul><p class=edit-page><a href=https://github.com/YIO-Remote/documentation/blob/master/content/developers/integrations/index.md><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-edit-2"><path d="M17 3a2.828 2.828.0 114 4L7.5 20.5 2 22l1.5-5.5L17 3z"/></svg>Edit this page on GitHub</a></p><div class="docs-navigation d-flex justify-content-between"><a href=https://yio-remote.github.io/documentation/developers/configuration-file/><div class="card my-1"><div class="card-body py-2">&larr; Configuration file</div></div></a><a class=ms-auto href=https://yio-remote.github.io/documentation/developers/entity-types/><div class="card my-1"><div class="card-body py-2">Entity types &rarr;</div></div></a></div></main></div></div></div><footer class="footer text-muted"><div class=container><div class=row><div class="col-lg-8 order-last order-lg-first"><ul class=list-inline><li class=list-inline-item>Documentation by the YIO community - Website powered by <a href=https://gohugo.io/>Hugo</a> and <a href=https://getdoks.org/>Doks</a> theme</li></ul></div><div class="col-lg-8 order-first order-lg-last text-lg-end"><ul class=list-inline></ul></div></div></div></footer><script src=https://yio-remote.github.io/documentation/js/highlight.min.e9108a0b3c03958002f9650a02a3c3dcc2c69459b908c8440f7d2ad360aa0f216c0023ba6192f82a8bdbd996bd314e1e0cff114a8f54a0166630560d0be8ede7.js integrity="sha512-6RCKCzwDlYAC+WUKAqPD3MLGlFm5CMhED30q02CqDyFsACO6YZL4Kovb2Za9MU4eDP8RSo9UoBZmMFYNC+jt5w==" crossorigin=anonymous defer></script><script src=https://yio-remote.github.io/documentation/main.min.7ab523108435955765bcb88a0ee704f412ba01646b5478e84f3b9feb24f0ce750a14c3f7bd9a62408fe21e41996d361a9eb29f77e85dfe77b7e17f7623bd3a97.js integrity="sha512-erUjEIQ1lVdlvLiKDucE9BK6AWRrVHjoTzuf6yTwznUKFMP3vZpiQI/iHkGZbTYanrKfd+hd/ne34X92I706lw==" crossorigin=anonymous defer></script><script src=https://yio-remote.github.io/documentation/index.min.e14891b6d51048ed19820a09e27eadf203203e236ff4c63b52693320a4f3d78c25e581955ace855112d9080fbbb5424be52abc1702187ef3badc1c447f9545a9.js integrity="sha512-4UiRttUQSO0ZggoJ4n6t8gMgPiNv9MY7UmkzIKTz14wl5YGVWs6FURLZCA+7tUJL5Sq8FwIYfvO63BxEf5VFqQ==" crossorigin=anonymous defer></script></body></html>